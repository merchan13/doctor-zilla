<%= render 'shared/errors', obj: @record %>
<div class="col-md-9 new-panel main-panel">

  <% if params[:action] == 'edit' %>
    <h3 align="center"><strong>Editar Historia</strong></h3>
  <% elsif params[:action] == 'new' %>
    <h3 align="center"><strong>Nueva Historia</strong></h3>
  <% end %>

  <div class="col-md-12"><hr></div>

  <%= form_for(@record, :html => {class: 'form-horizontal', role: 'form'}) do |f| %>

    <% if params[:action] == 'new' || params[:action] == "create" %>
      <%= f.hidden_field :first_consultation_date, value: Date.today.to_s %>
    <% end %>

    <!-- IDENTIFICACIÓN -->
    <div class="form-group col-md-5">
      <div class="col-md-12">
        <%= f.label :identificación, class: 'form-control-label' %>
      </div>
      <div class="col-md-3">
        <select class="form-control" name="medical_record[document_type]" id="medical_record_document_type">
          <option value="V">V</option>
          <option value="E">E</option>
          <option value="P">P</option>
        </select>
      </div>
      <div class="col-md-6">
        <%= f.text_field :document, class: 'form-control', placeholder: 'Número de identificación', autofocus: true %>
      </div>
    </div>

    <!-- NOMBRES -->
    <div class="form-group col-md-7">
      <div class="col-md-6">
        <%= f.label :nombres, class: 'form-control-label' %>
        <%= f.text_field :name, class: 'form-control', placeholder: 'Nombres del paciente', autofocus: true %>
      </div>
      <div class="col-md-6">
        <%= f.label :apellidos, class: 'form-control-label' %>
        <%= f.text_field :last_name, class: 'form-control', placeholder: 'Apellidos del paciente', autofocus: true %>
      </div>
    </div>

    <div class="col-md-12">
      <br>
    </div>

    <!-- PROFESION / FECHA DE NACIMIENTO -->
    <div class="form-group col-md-12">
      <div class="col-md-4">
        <%= f.label :profesión, class: 'form-control-label' %>
        <%= f.select :occupation_id, options_from_collection_for_select(Occupation.order(name: :asc), :id, :name, @record.occupation_id), {include_blank: 'N/A'}, class: 'form-control' %>
        <a href="#" data-toggle="modal" data-target="#new-occupation-modal">Agrear nuevo</a>
      </div>
      <div class="col-md-3">
        <%= f.label :fecha_de_nacimiento, class: 'form-control-label' %>
        <%= f.text_field :birthday, class: 'form-control', placeholder: "Seleccione una fecha", "data-provide" => 'datepicker', "data-date-format" => 'dd/mm/yyyy' %>
      </div>
      <div class="col-md-2">
        <%= f.label :edad, class: 'form-control-label' %>
        <p id="age_text"></p>
      </div>
    </div>

    <div class="col-md-12">
      <br>
    </div>

    <!-- SEXO -->
    <div class="form-group col-md-6">
      <div class="col-md-12">
        <%= f.label :sexo, class: 'form-control-label' %>
      </div>
      <div class="form-check col-md-4">
        <%= f.radio_button :gender, 'masculine', class: 'form-check-input' %>
        <small><strong>Masculino</strong></small>
      </div>
      <div class="form-check col-md-4">
        <%= f.radio_button :gender, 'femenine', class: 'form-check-input' %>
        <small><strong>Femenino</strong></small>
      </div>
    </div>

    <!-- FOTO -->
    <div class="col-md-3">
      <%= f.label :Foto_del_paciente, class: 'form-control-label' %>
      <% if @record.profile_picture.url.present? %>
        <%= image_tag(@record.profile_picture.url, class: 'img-responsive img-circle') %>
        <%= f.label :remove_profile_picture do %>
          <small>Borrar foto </small><%= f.check_box :remove_profile_picture %>
        <% end %>
      <% end %>
      <%= f.file_field :profile_picture %>
      <%= f.hidden_field :profile_picture_cache %>
    </div>

    <div class="col-md-12"><hr></div>

    <!-- TELÉFONOS / EMAIL -->
    <div class="form-group col-md-12">
      <div class="col-md-4">
        <%= f.label :teléfono_casa, class: 'form-control-label' %>
        <%= f.text_field :phone_number, class: 'form-control', placeholder: 'Teléfono fijo del paciente', autofocus: true %>
      </div>
      <div class="col-md-4">
        <%= f.label :teléfono_celular, class: 'form-control-label' %>
        <%= f.text_field :cellphone_number, class: 'form-control', placeholder: 'Teléfono celular del paciente', autofocus: true %>
      </div>
      <div class="col-md-4">
        <%= f.label :email, class: 'form-control-label' %>
        <%= f.text_field :email, class: 'form-control', placeholder: 'Correo electrónico del paciente', autofocus: true %>
      </div>
    </div>

    <div class="col-md-12">
      <br>
    </div>

    <!-- DIRECCIÓN -->
    <div class="form-group col-md-12">
      <div class="col-md-12">
        <%= f.label :dirección_de_habitación, class: 'form-control-label' %>
        <%= f.text_field :address, class: 'form-control', placeholder: 'Dirección completa del paciente' %>
      </div>
    </div>

    <div class="col-md-12"><hr></div>

    <!-- REFERENCIA / SEGURO -->
    <div class="form-group col-md-12">
      <div class="col-md-4">
        <%= f.label :referido_por, class: 'form-control-label' %>
        <%= f.text_field :referred_by, class: 'form-control', placeholder: 'Persona que refirió al paciente' %>
      </div>
      <div class="col-md-4">
        <%= f.label :seguro, class: 'form-control-label' %>
        <%= f.select :insurance_id, options_from_collection_for_select(Insurance.order(name: :asc), :id, :name, @record.insurance_id), {include_blank: 'N/A'}, class: 'form-control' %>
        <a href="#" data-toggle="modal" data-target="#new-insurance-form">Agrear nuevo</a>
      </div>
    </div>

    <div class="col-md-12">
      <br>
    </div>

    <!-- ANTECEDENTES. -->
    <% if params[:action] == 'edit' %>
      <%= render partial: 'backgrounds', locals: { f: f, record: @record } %>
    <% end %>

    <div class='form-group center'>
      <div class='col-md-offset-4 col-md-4'>
        <%= f.submit class: 'btn btn-primary btn-lg' %>
      </div>
    </div>
  <% end %>
</div>

<%= render partial: 'side_menu', locals: { record: @record } %>

<%= render 'modals' %>
